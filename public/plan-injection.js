!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="public/",n(n.s=1)}([,function(e,t,n){"use strict";n.r(t);let i="",r=(new Date).getTime();function s(e){var t,n,s;(new Date).getTime()-r<500||(r=(new Date).getTime(),"isTagallNewColor"in e&&location.href.includes("/task/view/")&&[...document.querySelectorAll("div.feed-com-text div.feed-com-text-inner")].forEach(e=>{!e.querySelector("b.tagall_color")&&e.innerText.includes("TAGALL")&&(e.innerHTML=e.innerHTML.replace(/TAGALL/g,'<b class="tagall_color">TAGALL</b>'))}),"isMarkMissingUsers"in e&&function(){if(location.href.includes("/task/view/")){const e=[...document.querySelectorAll("div.task-detail-sidebar-content a.task-detail-sidebar-info-user-name.task-detail-sidebar-info-user-name-link")],t=[...document.querySelectorAll('div.feed-com-text-inner-inner a[href^="/company/personal/user/"]')];if(e.length>0&&t.length>0){const n=[],i=/.*\/user\/(\d+?)\/.*/i;e.forEach(e=>{const t=i.exec(e.href);t&&n.push(t[1])}),t.forEach(e=>{const t=i.exec(e.href);return n.includes(t[1])||e.classList.contains("marked-link")?n.includes(t[1])&&e.classList.contains("marked-link")&&(e.style="",e.title="",e.classList.remove("marked-link")):(e.style="background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/3/37/Emblem-important-red.svg/120px-Emblem-important-red.svg.png); background-repeat: no-repeat; background-size: 15px 15px; background-position-x: 99%; padding-right: 20px;",e.title="Пользователь не добавлен в задачу",e.classList.add("marked-link")),!0})}}}(),"isHideForumInSearchResult"in e&&[...document.querySelectorAll("div.search-title-top-list-wrap div.search-title-top-item.search-title-top-item-js")].forEach(e=>{const t=e.querySelector("a.search-title-top-item-link").href;(t.includes("/community/forum/")||t.includes("#message"))&&(e.style.display="none")}),"isHideNotForUserMessages"in e&&"firstName"in e&&"secondName"in e&&(t=e.firstName,n=e.secondName,[...document.querySelectorAll("div.bx-notifyManager-item")].forEach(e=>{!e.innerText.includes(" комментарий к задаче [#")||e.innerText.includes(`${t} ${n}`)||e.innerText.includes(`${n} ${t}`)||e.innerText.toLowerCase().includes("tagall")||e.querySelectorAll("a.bx-notifier-item-delete")[0].click()})),"isDisableShowTaskOnTagClick"in e&&[...document.querySelectorAll("span.tasks-kanban-item-tags span")].forEach(e=>!e.hasAttribute("onclick")&&(e.setAttribute("onclick","event.stopPropagation();"),!0)),"isAutoChoiseFindSingleUser"in e&&function(){const e=document.querySelector("div#BXSocNetLogDestinationSearch.popup-window.bx-finder-popup.bx-finder-v2");if(e){const t=e.querySelectorAll("a.bx-finder-box-item-t7.bx-finder-element.bx-lm-element-user");1===t.length&&t[0].click()}}(),"isChangeTitleOnProjectPage"in e&&function(){if(-1!==location.href.search(/^https:\/\/plan.pixelplus.ru\/workgroups\/group\/\d.+?\/tasks\/($|\?)/gi)){let e="";"("===document.title[0]&&(e=`${/^(\(.+?\))/gi.exec(document.title)[1]} `),document.title=`${e+document.querySelector("div.profile-menu-info a").innerText.replace(" — SEO","")} — Задачи проекта`}if("("!==document.title[0]){const e=document.querySelector("div.bx-im-informer-num");e&&e.innerText.length>0&&(document.title=`(${e.innerText}) ${document.title}`)}}(),"isAddLongLinkRepair"in e&&function(){if(!location.href.includes("/task/view/")||document.querySelector("span.long-link-repair"))return!1;const e=document.createElement("span");e.className="long-link-repair",e.style="color: #a8aeb5; font-size: 13px; display: block;",e.innerText="Починить ссылки";const t=document.querySelector("div.task-detail-like");t&&t.appendChild(e),e.addEventListener("click",e=>{[...document.querySelectorAll("div.task-detail-description a, div.feed-com-text-inner-inner a")].forEach(t=>{t.innerText.includes("...")&&(t.innerText=t.href),e.target.innerText="OK"})}),e.addEventListener("mouseover",e=>{e.target.style.cursor="pointer",e.target.style.color="#828b95"}),e.addEventListener("mouseout",e=>{e.target.style.cursor="default",e.target.style.color="#a8aeb5"})}(),"isAddDelAllTaskMessages"in e&&function(){if(!location.href.includes("/task/view/")||document.querySelector("span.delete-messages-alert"))return!1;const e=document.createElement("span");e.className="delete-messages-alert",e.style="color: #a8aeb5; font-size: 13px; display: block; cursor: pointer;",e.innerText="Удалить уведомления задачи";const t=document.querySelector("div.task-detail-like");async function n(e,t){const n=await fetch(e,t);return await n.text()}t&&t.appendChild(e),e.addEventListener("click",()=>{n("https://plan.pixelplus.ru/alert/",{method:"GET",credentials:"same-origin"}).then(t=>{const i=[],r=/\/tasks\/task\/view\/(\d+?)\/.*/i,o=r.exec(location.href)[1];[...(new DOMParser).parseFromString(t,"text/html").querySelectorAll("div.message-item div.message-message")].forEach(e=>{const t=e.querySelector('a[href*="/task/view/"]');if(!t)return!1;if(r.exec(t.href)[1]!==o)return!1;const a=e.getAttribute("data-id");return n("https://plan.pixelplus.ru/bitrix/components/bitrix/im.messenger/im.ajax.php?NOTIFY_REMOVE&V=72",{method:"POST",credentials:"same-origin",body:`IM_NOTIFY_REMOVE=Y&NOTIFY_ID=${a}&IM_AJAX_CALL=Y&sessid=${s}`,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(()=>{i.push(a),localStorage.deletedMessages=i}),!0}),e.innerText="Уведомления удалены"})}),e.addEventListener("mouseout",e=>{e.target.style.color="#a8aeb5"})}(),"isMarkMessagesWithoutDestination"in e&&function(){if(!location.href.includes("/task/view/"))return!1;const e=[...document.querySelectorAll("div.feed-com-text")];let t=!1;function n(e,t,n){const i=e.previousElementSibling,r=document.createElement("span");i.querySelector("span.warning_message")||(r.className="warning_message",r.style="background-image: url(https://stjah.com/image/catalog/text/01publick.png); width: 20px; height: 20px; top: 5px; position: absolute; z-index: 9999; background-size: 20px 20px;",r.title=t,i.appendChild(r)),n&&!n.classList.contains("marked")&&(n.style="background-image: url(https://minecraft-statistic.net/img/screen/icon/166252.png); background-repeat: no-repeat; background-size: 15px 15px; background-position-x: 99%; padding-right: 20px;",n.title="Упоминание пользователя не в первых 100 символах сообщения",n.classList.add("marked"))}e.forEach(e=>{const i=e.previousElementSibling,r=i.firstChild.getAttribute("bx-tooltip-user-id");let s=e.innerText;const o=/\/company\/personal\/user\/(\d+?)\/.*/i;if((s=s.substring(0,101)).toLowerCase().includes("tagall"))return i.querySelector("span.warning_message")&&(i.querySelector("span.warning_message").className=""),!1;const a=e.querySelectorAll('a[href*="/company/personal/user/"]');for(let i=0;i<a.length;i++){const l=a[i].innerText;r!==o.exec(a[i].href)[1]&&(s.includes(l)?t=!0:n(e,"Обращение к пользователю не в первых 100 символах",a[i]))}return!i.querySelector("span.warning_message")&&(t||n(e,"В первой части комментария нет ни одного обращения к другому пользователю",void 0),!0)})}(),"isOpenAllCommentsInTask"in e&&function(){if(!location.href.includes("/task/view/"))return!1;const e=document.querySelector("a.feed-com-all");if(e&&!document.querySelector("a.open-all-comments")){const t=document.createElement("a");let n=location.href.replace(/#.*/gi,"");t.className="feed-com-all open-all-comments",n+=""===window.location.search?"?MID=1":"&MID=1",t.setAttribute("href",n),t.innerText=" | Открыть все комментарии",e.parentNode.insertBefore(t,e.nextElementSibling)}}(),"isAddEditTaskButton"in e&&[...document.querySelectorAll("div.tasks-kanban-item")].forEach(e=>{if(e.querySelector("a.edit-task-link"))return!1;const t=e.querySelector("a.tasks-kanban-item-title").href.replace("/view/","/edit/"),n=document.createElement("a");return n.setAttribute("href",t),n.className="edit-task-link",n.setAttribute("onclick","event.stopPropagation()"),n.setAttribute("title","Редактировать задачу"),n.style="background-image: url(https://quantummedia.it/wp-content/uploads/2018/01/if_Edit_1891026.png); width: 15px;height: 15px;right: 5px;top: 5px;position: absolute;z-index: 9999;background-size: 15px 15px;",e.insertBefore(n,e.firstChild),!0}),"isAddCurrentMountButton"in e&&(s=i,[...document.querySelectorAll("div.tasks-kanban-item")].forEach(e=>{if(e.querySelector("span.add-mount-tag"))return!1;const t=document.createElement("span");return t.className="add-mount-tag",t.setAttribute("onclick","event.stopPropagation();"),t.setAttribute("title","Добавить тег текущего месяца"),t.style="background-image: url(http://files.softicons.com/download/application-icons/toolbar-icons-by-gentleface/png/128/tag.png); width: 15px;height: 15px;right: 5px;top: 23px;position: absolute;z-index: 9999;background-size: 15px 15px;",t.addEventListener("click",e=>{const t=(new Date).toLocaleString("ru",{year:"numeric",month:"long"}).replace(/ (\d\d|г\.)/gi," ").trim(),n=/.*\/view\/(\d+?)\/.*/gi.exec(e.target.parentNode.querySelector("a.tasks-kanban-item-title").href),i=new XMLHttpRequest;i.open("POST","https://plan.pixelplus.ru/bitrix/components/bitrix/tasks.base/ajax.php",!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.send(`sessid=${s}&EMITTER=&ACTION[0][OPERATION]=task.update&ACTION[0][ARGUMENTS][id]=${n[1]}&ACTION[0][ARGUMENTS][data][TAGS]=${t}`)}),t.addEventListener("mouseover",e=>{e.target.style.cursor="pointer"}),t.addEventListener("mouseout",e=>{e.target.style.cursor="default",e.target.style.color="#a8aeb5"}),e.insertBefore(t,e.firstChild),!0})))}chrome.storage.local.get("options",e=>{const t=e.options;if(!t)return!1;if("styles"in t){const e=document.createElement("style");e.id="pixel-plan-injection-extension",e.innerHTML=t.styles,document.documentElement.appendChild(e)}return document.addEventListener("DOMContentLoaded",()=>{i=function(){const e=document.createElement("script");return e.id="planInjectionScript",e.innerHTML='(phpVars.bitrix_sessid === "" && typeof (bxSession) !== "undefined" && "sessid" in bxSession) ? planInjectionScript.dataset.bxsessid = bxSession.sessid : planInjectionScript.dataset.bxsessid = phpVars.bitrix_sessid;',document.head.appendChild(e),e.dataset.bxsessid}(),s(t),location.href.includes("https://plan.pixelplus.ru/alert/")&&function(e){"isAddDelAllTaskMessages"in e&&window.addEventListener("storage",()=>{if(!localStorage.deletedMessages)return;const e=localStorage.deletedMessages.split(",");e.forEach(e=>{const t=document.querySelector(`div.message-message[data-id="${e}"]`);return!!t&&(t.parentNode.parentNode.parentNode.classList.contains("task-messages-wrapper")?t.parentNode.parentNode.parentNode.outerHTML="":t.parentNode.parentNode.removeChild(t.parentNode),!0)}),localStorage.removeItem(e)});"isMarkMessagesToUsers"in e&&"firstName"in e&&"secondName"in e&&(t=e.firstName,n=e.secondName,[...document.querySelectorAll("div.message-message")].forEach(e=>{(e.innerText.includes(`${t} ${n}`)||e.innerText.includes(`${n} ${t}`)||e.innerText.toLowerCase().includes("tagall"))&&(e.previousElementSibling.style="background-image: url(https://e.unicode-table.com/orig/81/912866cba59b54bb8f5271f6ac5a68.png); background-repeat: no-repeat; background-size: 20px; background-position: -2px 37%;")}),[...document.querySelectorAll("div.task-messages-wrapper")].forEach(e=>{(e.querySelector("div.task-messages").innerText.includes(`${t} ${n}`)||e.querySelector("div.task-messages").innerText.includes(`${n} ${t}`)||e.querySelector("div.task-messages").innerText.toLowerCase().includes("tagall"))&&(e.style='background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%228%22%20height%3D%2211%22%20viewBox%3D%220%200%208%2011%22%3E%0A%20%20%3Cpath%20fill%3D%22%23F16C0A%22%20fill-rule%3D%22evenodd%22%20d%3D%22M200.069979%2C24%20L200.14%2C24%20C200.14%2C24%20203%2C23.0560625%20203%2C20.390625%20C203%2C16.6348125%20199.346667%2C15.8813125%20199.666667%2C13%20C197.993333%2C13.8339375%20195%2C16.75375%20195%2C19.875%20C195.039359%2C21.7259245%20196.174362%2C23.3629491%20197.86%2C24%20L197.86%2C24%20L198.123417%2C24%20C197.460595%2C23.3218266%20197.059336%2C22.4251727%20197%2C21.4707569%20C197.092476%2C20.0452868%20197.868205%2C18.7524059%20199.082454%2C18%20C200.109798%2C20.1851885%20201.164908%2C19.9436239%20201.164908%2C21.4707569%20C201.162991%2C22.4339232%20200.76293%2C23.3471724%20200.069979%2C24%20Z%22%20transform%3D%22translate%28-195%20-13%29%22/%3E%0A%3C/svg%3E%0A"); background-repeat: no-repeat; background-size: 13px; background-position: 5px 17px;')}));var t,n;"isAddGroupName"in e&&[...document.querySelectorAll("div.task-messages-wrapper")].forEach(e=>{const t=e.querySelector("div.task-messages div.message-item div.message-message a"),n=t.href.replace(/task\/view\/.+/gi,""),i=/в группе (.+)\)/gi.exec(t.outerHTML);if(!Array.isArray(i))return!1;const r=e.querySelector("div.task-title"),s=document.createElement("a");return s.setAttribute("href",n),s.innerText=i[1],r.innerHTML+=" | Группа ",r.appendChild(s),!0});"isAddAllTasksOpenButton"in e&&function(){const e=document.createElement("span");e.style="display: inline-block; vertical-align: middle; background-color: #e4ae16; padding: 0 10px; font-size: 12px; text-align: center; text-align-last: center; line-height: 24px; border: none; color: #ffffff; transition: all .3s; box-sizing: border-box; cursor: pointer; border-radius: 6px;",e.innerText="Открыть все задачи",document.querySelector("a.delete-button").parentNode.insertBefore(e,document.querySelector("a.delete-button").nextElementSibling),e.addEventListener("click",()=>{const e=[...document.querySelectorAll("div.message-message")],t=[];e.forEach(e=>{const n=e.querySelector("a").href;if(!n.includes("/tasks/task/view/"))return!1;const i=/\/tasks\/task\/view\/(\d+?)\/.*/i.exec(n)[1];return!t.includes(i)&&(t.push(i),window.open(n),!0)})})}();"isAddGroupFilter"in e&&function(){const e=[...document.querySelectorAll("div.task-messages-wrapper")],t=[...document.querySelectorAll("div.message-item")];if(0===e.length&&0===t.length)return!1;const n={},i=document.createElement("select");i.style="height: 30px; font-size: 12px; border: 1px solid #dbdbdb; margin-left: 25px; width: 200px;",i.className="plan_injection_messages_filter",e.length>0&&t.length>0&&e.forEach(e=>{e.classList.add("injection_group");const t=e.querySelector("div.task-messages div.message-item div.message-message a");if(!t)return e.classList.add("injection_script_filter_none"),n.none="none"in n?n.none+1:1,!1;let i=/в группе (.+)\)/gi.exec(t.outerHTML);return Array.isArray(i)?((i=i[1])in n?n[i].count++:n[i]={count:1,id:Object.keys(n).length},e.classList.add(`injection_script_filter_${n[i].id}`),!0):(e.classList.add("injection_script_filter_none"),n.none="none"in n?n.none+1:1,!1)}),0===e.length&&t.length>0&&t.forEach(e=>{e.classList.add("injection_group");const t=e.querySelector("div.message-message a");if(!t)return e.classList.add("injection_script_filter_none"),n.none="none"in n?n.none+1:1,!1;let i=/в группе (.+)\)/gi.exec(t.outerHTML);return Array.isArray(i)?((i=i[1])in n?n[i].count++:n[i]={count:1,id:Object.keys(n).length},e.classList.add(`injection_script_filter_${n[i].id}`),!0):(e.classList.add("injection_script_filter_none"),n.none="none"in n?n.none+1:1,!1)});const r=document.createElement("option");if(r.value="all",r.innerText="Все группы",i.appendChild(r),document.querySelector("div.injection_script_filter_none")){const e=document.createElement("option");e.value="none",e.innerText=`Без группы (${n.none})`,i.appendChild(e)}Object.keys(n).sort().forEach(e=>{if("none"===e)return!1;const t=document.createElement("option");return t.innerText=`${e} (${n[e].count})`,t.value=n[e].id,i.appendChild(t),!0});const s=document.createElement("style");s.id="groupFilterInjection",document.head.appendChild(s),i.addEventListener("change",()=>{s.innerHTML="all"===i.value?"":`.injection_group{display: none !important;} div.injection_script_filter_${i.value}{display: block !important;}`});const o=document.querySelectorAll("div.settings-row");o.length>0&&o[o.length-1].appendChild(i)}();!function(){const e=document.querySelector("div.im-messages");!!e&&new MutationObserver(e=>{const t=document.querySelector("div.im-messages")?document.querySelector("div.im-messages").children.length:0,n=document.querySelector("span.alert-total b");if(n&&(n.innerText=t),document.querySelector("select.plan_injection_messages_filter")){let t=/injection_script_filter_([\da-z]+)/gi.exec(e[0].removedNodes[0].className);t&&(t=t[1]);const n=document.querySelector(`select.plan_injection_messages_filter option[value="${t}"]`);if(!n)return!1;let i=/ \((\d+)\)/gi.exec(n.innerText);i&&(i=Number(i[1])-1),n.innerText=n.innerText.replace(/ \((\d+)\)/gi,` (${i})`)}return!0}).observe(e,{attributes:!1,childList:!0,characterData:!1})}()}(t),new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type?e.addedNodes.length>0?s(t):e.removedNodes.length>0&&s(t):"attributes"===e.type&&("class"!==e.attributeName&&"style"!==e.attributeName||s(t))})}).observe(document,{childList:!0,attributes:!0,subtree:!0,characterData:!0,attributeFilter:["class","style"]}),window.addEventListener("focus",()=>{s(t)}),window.addEventListener("blur",()=>{s(t)})}),!0})}]);